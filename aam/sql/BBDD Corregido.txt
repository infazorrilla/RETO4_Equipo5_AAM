use aam;

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";

CREATE TABLE IF NOT EXISTS `address` (
  `id_address` int(5) AUTO_INCREMENT,
  `country` enum('GERMANY', 'FRANCE', 'ITALY', 'SPAIN') NOT NULL,
  `street` varchar(20) NOT NULL,
  `cod_postal` varchar(20) NOT NULL,
  `city` varchar(20) NOT NULL,
  `province` varchar(20) NOT NULL,
  PRIMARY KEY (`id_address`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE IF NOT EXISTS `person`(
  `id_person` int(5) AUTO_INCREMENT,
  `id_address` int(5) DEFAULT NULL,
  `name` varchar(10) DEFAULT NULL,
  `lastname` varchar(20) DEFAULT NULL,
  `email` varchar(50) NOT NULL,
  `password` varchar(40) NOT NULL,
  `image` varchar(20),
  `status` enum('ENABLED', 'DISABLED') DEFAULT 'DISABLED',
  PRIMARY KEY (`id_person`)
  -- KEY `id_address` (`id_address`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE IF NOT EXISTS `customers` (
  `id_customer` int(5) AUTO_INCREMENT,
  `id_person` int(5) NOT NULL,
  PRIMARY KEY (`id_customer`)
  -- KEY `id_person` (`id_person`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE IF NOT EXISTS `employee_type` (
  `id_employee_type` int(5) AUTO_INCREMENT,
  `description` varchar(100) NOT NULL,
  PRIMARY KEY (`id_employee_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE IF NOT EXISTS `employees` (
  `id_employee` int(5) AUTO_INCREMENT,
  `id_person` int(5) NOT NULL,
  `id_employee_type` int(5) NOT NULL,
  PRIMARY KEY (`id_employee`)
  -- KEY `id_person` (`id_person`)
  -- KEY `id_employee_type` (`id_employee_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE IF NOT EXISTS `brands` (
  `id_brand` int(5) NOT NULL AUTO_INCREMENT,
  `brand` varchar(20) NOT NULL,
  PRIMARY KEY (`id_brand`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4;

CREATE TABLE IF NOT EXISTS `employee_brand` (
  `id_employee` int(5) NOT NULL,
  `id_brand` int(5) NOT NULL,
  PRIMARY KEY (`id_employee`, `id_brand`)
  -- KEY `id_brand` (`id_brand`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE IF NOT EXISTS `payments` (
  `id_payment` int(5) AUTO_INCREMENT,
  `iban` varchar(50) NOT NULL,
  `cvv` varchar(3) NOT NULL,
  `expirationDate` date NOT NULL,
  PRIMARY KEY (`id_payment`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE IF NOT EXISTS `shoppingcart` (
  `id_shoppingcart` int(5) AUTO_INCREMENT,
  `totalPrice` double NOT NULL,
  `descount` double DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id_shoppingcart`)
) ENGINE=InnoDB AUTO_INCREMENT=26 DEFAULT CHARSET=utf8mb4;

CREATE TABLE IF NOT EXISTS `orders` (
  `id_order` int(5) AUTO_INCREMENT,
  `id_customer` int(5) NOT NULL,
  `id_address` int(5) DEFAULT NULL,
  `id_shoppingcart` int(5) NOT NULL,
  `id_payment` int(5) DEFAULT NULL,
  `status` enum('pending', 'awaiting_shipment', 'shipped', 'cancelled') DEFAULT NULL,
  `totalPrice` double NOT NULL,
  `delivery_date` date DEFAULT NULL,
  `orderDate` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id_order`)
  -- KEY `id_customer` (`id_customer`),
  -- KEY `id_address` (`id_address`),
  -- KEY `id_shoppingcart` (`id_shoppingcart`),
  -- KEY `id_payment` (`id_payment`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE IF NOT EXISTS `products` (
  `id_product` int(5) AUTO_INCREMENT,
  `id_brand` int(5) NOT NULL,
  `category` enum('Dress', 'Jeans', 'Tshirt', 'Shoes') NOT NULL,
  `gender` enum('M', 'H') NOT NULL,
  `image` varchar(20) NOT NULL,
  PRIMARY KEY (`id_product`)
  -- KEY `id_brand` (`id_brand`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4;

CREATE TABLE IF NOT EXISTS `employee_order` (
  `id_employee` int(5) NOT NULL,
  `id_order` int(5) NOT NULL,
  PRIMARY KEY (`id_employee`, `id_order`)
  -- KEY `id_order` (`id_order`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE IF NOT EXISTS `productitems` (
  `id_product_item` int(5) AUTO_INCREMENT,
  `id_product` int(5) NOT NULL,
  `price` double NOT NULL,
  `stock` int(11) NOT NULL,
  `referenceNumber` varchar(50) DEFAULT NULL,
  `size` enum('M', 'L', 'S', '34', '36', '37', '38', '39', '40', '41', '42', '43', '44', '45') NOT NULL,
  PRIMARY KEY (`id_product_item`)
  -- KEY `id_product` (`id_product`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4;

CREATE TABLE IF NOT EXISTS `shoppingcartitems` (
  `id_shoppingCartItem` int(5) AUTO_INCREMENT,
  `id_shoppingcart` int(5) NOT NULL,
  `id_product_item` int(5) NOT NULL,
  `price` double NOT NULL,
  `quantity` int(11) NOT NULL,
  PRIMARY KEY (`id_shoppingCartItem`)
  -- KEY `id_shoppingcart` (`id_shoppingcart`)
  -- KEY `id_product_item` (`id_product_item`)
) ENGINE=InnoDB AUTO_INCREMENT=19 DEFAULT CHARSET=utf8mb4;

ALTER TABLE `person`
  ADD CONSTRAINT `person_ibfk_1` FOREIGN KEY (`id_address`) REFERENCES `address` (`id_address`) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE `customers`
  ADD CONSTRAINT `customers_ibfk_1` FOREIGN KEY (`id_person`) REFERENCES `person` (`id_person`) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE `employees`
  ADD CONSTRAINT `employees_ibfk_1` FOREIGN KEY (`id_person`) REFERENCES `person` (`id_person`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `employees_ibfk_2` FOREIGN KEY (`id_employee_type`) REFERENCES `employee_type` (`id_employee_type`);

ALTER TABLE `products`
  ADD CONSTRAINT `products_ibfk_1` FOREIGN KEY (`id_brand`) REFERENCES `brands` (`id_brand`) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE `employee_brand`
  ADD CONSTRAINT `employee_brand_ibfk_1` FOREIGN KEY (`id_employee`) REFERENCES `employees` (`id_employee`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `employee_brand_ibfk_2` FOREIGN KEY (`id_brand`) REFERENCES `brands` (`id_brand`) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE `orders`
  ADD CONSTRAINT `orders_ibfk_1` FOREIGN KEY (`id_customer`) REFERENCES `customers` (`id_customer`),
  ADD CONSTRAINT `orders_ibfk_2` FOREIGN KEY (`id_address`) REFERENCES `address` (`id_address`),
  ADD CONSTRAINT `orders_ibfk_3` FOREIGN KEY (`id_shoppingcart`) REFERENCES `shoppingcart` (`id_shoppingcart`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `orders_ibfk_4` FOREIGN KEY (`id_payment`) REFERENCES `payments` (`id_payment`) ON DELETE CASCADE ON UPDATE CASCADE;
  
ALTER TABLE `employee_order`
  ADD CONSTRAINT `employee_order_ibfk_1` FOREIGN KEY (`id_employee`) REFERENCES `employees` (`id_employee`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `employee_order_ibfk_2` FOREIGN KEY (`id_order`) REFERENCES `orders` (`id_order`) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE `productitems`
  ADD CONSTRAINT `productitems_ibfk_1` FOREIGN KEY (`id_product`) REFERENCES `products` (`id_product`);

ALTER TABLE `shoppingcartitems`
  ADD CONSTRAINT `shoppingcartitems_ibfk_1` FOREIGN KEY (`id_shoppingcart`) REFERENCES `shoppingcart` (`id_shoppingcart`),
  ADD CONSTRAINT `shoppingcartitems_ibfk_2` FOREIGN KEY (`id_product_item`) REFERENCES `productitems` (`id_product_item`);